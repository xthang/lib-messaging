#
# Copyright (C) 2023 Ready.io.
#

language = "C"

header = "/*\nCopyright (C) 2023 Ready.io.\n*/\n"

include_guard = "MESSAGING_FFI_H_"

autogen_warning = "/* This file was automatically generated by cbindgen */"

style = "type"

[defines]
# "feature = signal-media" = "SIGNAL_MEDIA_SUPPORTED"

[enum]
prefix_with_name = true

[export]
include = ["SignalErrorCode", "FfiDirection", "FfiCiphertextMessageType", "FfiContentHint", "RandomnessBytes"]
exclude = ["TAG_SIZE", "NONCE_SIZE"]
item_types = ["enums", "functions", "opaque", "structs", "typedefs", "constants"]
# FIXME: this doesn't work well with constants in SCREAMING_SNAKE_CASE
prefix = "Msg"
renaming_overrides_prefixing = true

[export.rename]
# "FfiSessionStoreStruct" = "SignalSessionStore"
# "FfiIdentityKeyStoreStruct" = "SignalIdentityKeyStore"
# "FfiPreKeyStoreStruct" = "SignalPreKeyStore"
# "FfiSignedPreKeyStoreStruct" = "SignalSignedPreKeyStore"
# "FfiKyberPreKeyStoreStruct" = "SignalKyberPreKeyStore"
# "FfiSenderKeyStoreStruct" = "SignalSenderKeyStore"
# "FfiDirection" = "SignalDirection"
# "FfiCiphertextMessageType" = "SignalCiphertextMessageType"
# "FfiContentHint" = "SignalContentHint"
# "FfiInputStreamStruct" = "SignalInputStream"

"BorrowedSliceOfc_uchar" = "MsgBorrowedBuffer"
"BorrowedMutableSliceOfc_uchar" = "MsgBorrowedMutableBuffer"
"OwnedBufferOfc_uchar" = "MsgOwnedBuffer"

# Avoid double-prefixing these
"SignalFfiError" = "MsgFfiError"
"SignalErrorCode" = "MsgErrorCode"
"SignalMessage" = "MsgMessage"

[export.mangle]
remove_underscores = true

[fn]
sort_by = "None"
args = "horizontal"

[parse]
parse_deps = true
include = ["lib-messaging-protocol", "messaging-crypto"] # "signal-pin", "zkgroup", "signal-media", "mp4san"
extra_bindings = ["lib-messaging-bridge"] # "zkgroup"

[parse.expand]
crates = ["lib-messaging-ffi", "lib-messaging-bridge"]
features = ["lib-messaging-bridge/ffi"] # "lib-messaging-bridge/signal-media"
